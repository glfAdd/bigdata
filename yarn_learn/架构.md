## YARN 架构图

![YARN架构图](.\image\YARN架构图.png)

## YARN 执行流程

- 运行在 YARN 上的应用程序主要分为两类
  - 短应用程序: 指一定时间内（可能是秒级、分钟级或小时级, 天级或者更长）可运行完成并正常退出的应用程序，比如MapReduce作业
  - 指不出意外，永不终止运行的应用程序，通常是一些服务，比如HBase Service
- 通信都使用 RPC

![YARN执行流程图](.\image\YARN执行流程图.png)

```
1. client 向 YARN 提交应用程序, 其中包括 AM 程序, 启动 AM 的命令, 用户程序等
2. RM 为该应用程序分配第一个 Container，并与对应的 nm 通信，要求它在 Container 中启动应用程序的 AM
3. AM 首先向 RM 注册，这样用户可以直接通过 RM 查看应用程序的运行状态，然后它将为各个任务申请资源，并监控它的运行状态，直到运行结束，即重复步骤4~7
4. AM 采用轮询的方式通过 RPC 协议向 RM 申请和领取资源
5. 一旦 AM 申请到资源后，则与对应的 nm 通信，要求其启动任务
6. nm 为任务设置好运行环境（包括环境变量、jar包、二进制程序等）后, 将任务启动命令写到一个脚本中，并通过运行该脚本启动任务
7. 各个任务通过某 RPC 协议向 AM 汇报自己的状态和进度，以让 AM 随时掌握各个任务的运行状态，从而可以在任务失败时重新启动任务. 在应用程序运行过程中，用户可以随时通过RPC向 AM 查询应用程序的当前运行状态
8. 应用程序运行完成后, AM 向 RM 注销并关闭自己
```

##### 补充



```

https://zhuanlan.zhihu.com/p/66268831






```



## 日志聚集服务

```
日志聚集概念：应用运行完成以后，将程序运行日志信息上传到HDFS系统上。
日志聚集功能好处：可以方便的查看到程序运行详情，方便开发调试


```

