```

```

## YARN 架构图

![YARN架构图](.\image\YARN架构图.png)

## YARN 执行流程

```
运行在 YARN 上的应用程序主要分为两类：短应用程序和长应用程序
	短应用程序: 指一定时间内（可能是秒级、分钟级或小时级，尽管天级别或者更长时间的也存在，但非常少）可运行完成并正常退出的应用程序，比如MapReduce作业
	长应用程序: 指不出意外，永不终止运行的应用程序，通常是一些服务，比如HBase Service
```

![YARN执行流程图](.\image\YARN执行流程图.png)

```
1. client 向 YARN 提交应用程序, 其中包括 AM 程序, 启动 AM 的命令, 用户程序等
2. RM 为该应用程序分配第一个 Container，并与对应的 nm 通信，要求它在整个 Container 中启动应用程序的 AM
3. AM 首先向 RM 注册，这样用户可以直接通过 RM 查看应用程序的运行状态，然后它将为各个任务申请资源，并监控它的运行状态，直到运行结束，即重复步骤4~7
4. AM 采用轮询的方式通过 RPC 协议向 RM 申请和领取资源
5. 一旦 AM 申请到资源后，则与对应的 nm 通信，要求其启动任务
6. nm 为任务设置好运行环境（包括环境变量、jar包、二进制程序等）后, 将任务启动命令写到一个脚本中，并通过运行该脚本启动任务
7. 各个任务通过某 RPC 协议向 AM 汇报自己的状态和进度，以让 AM 随时掌握各个任务的运行状态，从而可以在任务失败时重新启动任务. 在应用程序运行过程中，用户可以随时通过RPC向 AM 查询应用程序的当前运行状态
8. 应用程序运行完成后, AM 向 RM 注销并关闭自己
```

##### 补充



```

https://zhuanlan.zhihu.com/p/66268831



```



```
分配一个容器后，AM 会要求 nm 使用这些资源来启动一个特定于应用程序的任务。此任务可以是在任何框架中编写的任何进程. nm 不会监视任务；它仅监视容器中的资源使用情况，举例而言，如果一个容器消耗的内存比最初分配的更多，它会结束该容器。

AM 会竭尽全力协调容器，启动所有需要的任务来完成它的应用程序。它还监视应用程序及其任务的进度，在新请求的容器中重新启动失败的任务，以及向提交应用程序的客户端报告进度。应用程序完成后，AM 会关闭自己并释放自己的容器。

尽管 RM 不会对应用程序内的任务执行任何监视，但它会检查 AM 的健康状况。如果 AM 失败，RM 可在一个新容器中重新启动它。您可以认为 RM 负责管理 AM，而 AM 负责管理任务。


```









## 日志聚集服务

```
日志聚集概念：应用运行完成以后，将程序运行日志信息上传到HDFS系统上。
日志聚集功能好处：可以方便的查看到程序运行详情，方便开发调试


```

